## Introduction and Project Overview

**contentful-hooks** is an internal Node.js CLI tool designed to automate the management of Contentful webhooks for an iGaming platform. Its primary purpose is to keep Contentful CMS data in sync with AWS OpenSearch indexes by programmatically creating, updating, and deleting webhooks that connect the two systems[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L3-L10). In plain terms, this tool eliminates the **manual effort** of configuring multiple webhooks via the Contentful web app. Instead of clicking through Contentful‚Äôs UI for each content model and environment, engineers can run a single command to provision or update **all required webhooks** for a given environment[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L7-L11). This ensures that whenever content (like game data, sections, or layouts) is published or modified in Contentful, an HTTP request is automatically sent to an AWS endpoint that updates the corresponding OpenSearch index.

From a technical perspective, **contentful-hooks** acts as a scripted intermediary between **Contentful** and **AWS OpenSearch**. It uses the Contentful Management API to create and manage webhook definitions, which point to AWS API Gateway endpoints (and ultimately to OpenSearch) for dev, staging, and production environments[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L14-L18). The tool reads environment-specific configuration (such as API credentials, Contentful Space IDs, OpenSearch endpoints) and generates **deterministic webhook payloads** for various content models. Each webhook definition includes custom headers for **idempotency**, **ownership identification**, and **deployment metadata** so that rerunning the tool is safe (existing hooks can be recognized and updated) and no duplicate hooks are created[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L10-L18). In summary, contentful-hooks automates the webhook setup needed to funnel content changes from Contentful to OpenSearch, providing both a **non-technical benefit** (reducing manual work) and a **technical solution** (consistent, configurable, scriptable webhooks provisioning).

## Tech Stack and Components

This project is implemented as a Node.js CLI and leverages a few key libraries and services:

- **Node.js 18+** ‚Äì The runtime environment for executing the CLI scripts[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L13-L19). The code is written in modern JavaScript (ES modules).
- **Yarn** ‚Äì Used as the package manager and task runner (the project provides convenient Yarn scripts for common commands)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L13-L19).
- **Commander.js** ‚Äì A Node.js CLI framework for parsing commands and options. It powers the definition of subcommands like `create`, `update`, `delete` in contentful-hooks[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L10-L18).
- **Axios** ‚Äì An HTTP client library used to call the Contentful Management API (and possibly AWS endpoints). Axios is used for making REST requests to create, update, or delete webhook definitions in Contentful[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L14-L18).
- **Contentful Management API** ‚Äì The target API that the CLI calls to manage webhooks. The CLI uses Contentful‚Äôs management endpoints (via Axios) to perform CRUD operations on webhook definitions in a Contentful space[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L16-L18).
- **AWS API Gateway & OpenSearch** ‚Äì The ultimate destination for the webhook calls. Each Contentful webhook created by this tool is configured to send events to a specific AWS API Gateway URL, which fronts an OpenSearch cluster. In effect, publishing content triggers a webhook call through API Gateway to update an OpenSearch index[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L16-L19).
- **dotenv** ‚Äì Used for environment configuration. The tool uses `dotenv` to load environment variables from a `.env` file (based on a provided template) so that sensitive credentials (Contentful tokens, OpenSearch URLs and credentials) are not hardcoded[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L18-L19).
- **Crypto (Node built-in)** ‚Äì Used for generating SHA-256 hashes for idempotency keys and possibly other hashing needs (e.g., generating unique identifiers)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/utils.js#L40-L48).
- **Miscellaneous:** The project is structured as an ES Module (`"type": "module"` in package.json), uses ECMAScript features, and is intended as internal tooling (no public distribution, license is marked as internal/none)[GitHub](https://github.com/devminchev/tech-docs/blob/69c62ef62c3e714eea9f7246b08c7568435d8b05/contentful-cms-models/contentful-content-opensearch-webhooks/package.json#L2-L10)[GitHub](https://github.com/devminchev/tech-docs/blob/69c62ef62c3e714eea9f7246b08c7568435d8b05/contentful-cms-models/contentful-content-opensearch-webhooks/package.json#L20-L26).

## High-Level Architecture

**contentful-hooks** is organized as a single CLI application with modular components for configuration, payload construction, and API interactions. At a high level, the architecture is as follows:

- **CLI Entrypoint:** `src/index.js` is the main executable module. It uses Commander to define the CLI interface (commands like `create`, `create-v3`, `update`, `delete`, etc.) and their options[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/index.js#L92-L101)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/index.js#L118-L126). When a user runs a command, this file invokes a common `init` function with the appropriate operation flag[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/index.js#L62-L71)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/index.js#L92-L100).
- **Configuration:** `src/config.js` loads a nested configuration object that maps each **jurisdiction** (e.g., `eu`, `na`) and **environment** (`dev`, `stg`, `prod`) to the set of required credentials and endpoints[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/config.js#L2-L10)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/config.js#L28-L36). It pulls from environment variables (using `process.env`) for values like Contentful API tokens, Contentful Space IDs, OpenSearch host URLs, and credentials. This allows the tool to adapt to different deployment targets by switching environment variables.
- **Environment Variables:** An `env_example` file in the repository enumerates all the necessary environment keys. These include OpenSearch host URLs (`_OS_HOST`), credentials (`_OS_USER`/`_OS_PASS`), Contentful environment identifiers (`_CONTENTFUL_ENV`), Contentful API tokens and Space IDs (`_CONTENTFUL_BEARER_TOKEN` and `_CONTENTFUL_SPACE` for each environment and jurisdiction), as well as global selectors like `NODE_ENV` and `JURISDICTION`[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L70-L78)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L26-L34). A developer should copy this to a `.env` file and fill in the secrets for their dev/staging/prod setups before using the CLI.
- **HTTP Client:** `src/client.js` provides a factory to create an Axios instance pre-configured for the Contentful Management API[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L35-L39). It likely sets the base URL to the Contentful API (the space URL provided in config) and attaches the authentication token to requests. This client is used for all Contentful API calls (creating, updating, deleting webhooks).
- **Utilities:** `src/utils.js` contains shared helper functions such as configuration validation (ensuring all required fields are present)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/utils.js#L27-L34), base64 encoding for credentials (OpenSearch basic auth)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/utils.js#L24-L31), logging helpers, and functions to generate unique identifiers or idempotency keys for webhooks[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/utils.js#L40-L48)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/utils.js#L44-L53). For example, it defines headers like `X-unique-own-identifier` (a constant tag to mark webhooks created by this tool) and `X-unique-own-deployment-env` (to mark the environment) that are attached to each webhook definition for traceability[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/utils.js#L44-L53).
- **Constants:** `src/constants/` holds constants and naming logic. In particular, `constants/webhookTextParts.js` defines the naming conventions for webhook names and maps them to internal types and versions[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/constants/webhookTextParts.js#L2-L10)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/constants/webhookTextParts.js#L33-L41). For instance, it lists the suffix patterns used in webhook names (e.g., `"[Update] OpenSearch - gameV2"` for game updates) and helps the tool identify a webhook‚Äôs type (V2 vs V3) by examining its name[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/constants/webhookTextParts.js#L14-L22)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/constants/webhookTextParts.js#L72-L80).
- **Webhook Payload Builders:** `src/hookPayloads/` is a crucial directory containing **declarative payload builders** for each Contentful content model and webhook type (both V2 and V3 variants)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L37-L41). These modules export functions and JSON structures for constructing the webhook definitions. For example, a file like `gameV2HookPayloads.js` defines the exact JSON body that the Contentful webhook should send (which fields from the Contentful entry to include) and the target URL for game-related content[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/gameV2HookPayloads.js#L8-L16)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/gameV2HookPayloads.js#L40-L48). Each model (ventures, categories, games, sections, etc.) has a corresponding builder that encapsulates:
    - The **payload transformation** (mapping Contentful entry fields to a JSON structure expected by OpenSearch or downstream consumers)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/gameV2HookPayloads.js#L8-L16)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/gameV2HookPayloads.js#L32-L41).
    - The **filter conditions** so that the webhook only triggers for the intended content type and environment (e.g., ‚Äúonly trigger on content type X in environment ‚Äòdev‚Äô‚Äù)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/gameV2HookPayloads.js#L54-L62).
    - The **target URL** construction, which combines an OpenSearch index endpoint with the content ID (and includes a strategy for index refresh conflicts)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/gameV2HookPayloads.js#L46-L55)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/gameV2HookPayloads.js#L48-L56).
    - The **webhook name** generation, which uses a standardized prefix `[Lobby] [ENV] ...` plus a suffix indicating the content type (as defined in `webhookTextParts.js`)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/gameV2HookPayloads.js#L52-L60).
- **Core Webhook Logic:** `src/webhooksApi/` contains the logic for **orchestrating the creation, update, and deletion of webhooks**:
    - `webhookMethods.js` ‚Äì Defines high-level functions to create all webhooks for V2 or V3 (‚ÄúcreateWebhooksOnEnv‚Äù and ‚ÄúcreateV3WebhooksOnEnv‚Äù). These likely iterate through all the payload builders in `hookPayloads/` for the specified version and call the Contentful API to create each webhook[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L42-L48).
    - `publishHooks.js` ‚Äì Handles the creation of each webhook via the Contentful API. It likely calls helper functions to generate each webhook‚Äôs payload and then uses the Axios client to send the POST requests. The name suggests it‚Äôs used in the create workflow (publishing new hooks)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L42-L48).
    - `updateWebhooks.js` ‚Äì Contains the implementation of the update command. It fetches existing webhook definitions by ID and updates them. This module includes logic for verifying webhook ownership and type, then calling the Contentful API (via PUT) with an updated payload[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L44-L48).
    - `deleteHooks.js` ‚Äì Likely contains helper logic for building deletion requests (perhaps constructing deletion payloads or filters specific to delete operations, such as distinguishing general vs game-specific delete hooks)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L43-L46).
    - `deleteingWebhooks.js` (note the typo in name) ‚Äì Implements the runtime behavior of the **delete command**. It processes the CLI options (`-one`, `-env`, `-all`) and coordinates which webhooks to delete, using `collectHooks` to fetch and filter existing webhooks, then issuing the DELETE calls sequentially[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L43-L46).
    - `collectHooks.js` ‚Äì Provides functions to list existing webhooks from Contentful and filter them down to those ‚Äúowned‚Äù by this tool. It calls the Contentful API to get all webhook definitions and then filters for those containing the special header (`X-unique-own-identifier: lobby-openSearch`)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/collectHooks.js#L14-L22)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/collectHooks.js#L16-L24). It can further filter by environment tag (e.g., only `[DEV]` in the name) for the environment-specific deletion mode[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/collectHooks.js#L30-L37).
    - `webhooksHttpReq.js` ‚Äì Low-level wrappers around HTTP requests to Contentful for creating, updating, or deleting a webhook[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/webhooksHttpReq.js#L1-L9)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/webhooksHttpReq.js#L13-L21). These functions use the Axios client to POST new webhook definitions or PUT updates (including setting the `X-Contentful-Version` header for optimistic locking on updates[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/webhooksHttpReq.js#L13-L21)) and to DELETE webhooks by ID.
- **Documentation:** A `docs/` folder accompanies the code, containing detailed markdown documents (`webhook-create-workflow.md`, `webhook-update-workflow.md`, `webhook-delete-workflow.md`) that explain each command‚Äôs workflow with flowcharts and step-by-step descriptions[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L51-L58). These are useful for understanding the intended behavior and are summarized in this guide under ‚ÄúKey Workflows‚Äù.

Overall, the architecture cleanly separates **configuration** (credentials, environment specifics), **payload definition** (what each webhook sends and to where), and **execution logic** (how to create/update/delete through the Contentful API). Next, we‚Äôll explore how the CLI operates for each of its major commands.

## Key Workflows and Features

The contentful-hooks CLI provides three main operations: creating a suite of webhooks, updating existing webhooks, and deleting webhooks. Each operation has distinct workflow characteristics, outlined below.

### Webhook Creation Workflow (Bulk Provisioning)

When you run the **create command** (`yarn hook:create` for the standard ‚ÄúV2‚Äù webhooks, or `yarn hook:create:v3` for the newer V3 set), the tool will **provision an entire set of webhooks from scratch for the selected Contentful space and environment**. This creates the complete ‚Äúwebhook ecosystem‚Äù needed to mirror all relevant content types to OpenSearch. The process is summarized as follows:

1. **Initialize Environment:** The CLI reads the environment variables to determine the target **environment** (dev/stg/prod via `NODE_ENV`) and **jurisdiction** (eu/na via `JURISDICTION`), then loads the corresponding config from `config.js`[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L14-L21). It validates that all required credentials (Contentful API token, space ID, OpenSearch credentials, etc.) are present. If anything is missing, it aborts with an error before doing anything else.
2. **Select Webhook Suite (V2 vs V3):** Depending on the command (`create` implies V2 suite, `create-v3` implies V3 suite), the tool chooses the appropriate list of webhook payload builders to use[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L17-L25). The V2 suite consists of **10 webhooks** and the V3 suite consists of **12 webhooks**, each targeting different content models or actions.
3. **Sequential Creation:** The tool then iterates through the list of webhook definitions in a **fixed order**, creating them one by one via the Contentful API[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L23-L31). For each webhook type, it generates the payload and headers (using the functions in `src/hookPayloads/` and `src/utils.js`), and sends a `POST /webhook_definitions` request to Contentful to create the webhook[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L26-L34)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L62-L71). This sequence is predetermined to ensure any interdependencies are respected and to provide clear logging output for each step.
4. **Error Handling:** If **any webhook creation fails**, the create process implements a **fail-fast** strategy ‚Äì it will immediately stop the entire operation on the first error[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L30-L38)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L96-L99). The rationale is that a partial webhook setup could leave the environment in an inconsistent state, so it prefers to halt and let the user address the issue (and possibly clean up any webhooks that were created before the failure) rather than proceed. In such a case, the error is thrown and logged, and the user may need to manually delete any half-created webhooks via the Contentful UI or rerun the tool after fixing the problem.
5. **Completion:** If all webhook creations succeed, the CLI logs a success for each and at the end indicates the environment‚Äôs webhooks are all created[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L34-L38). At this point, Contentful will start sending events to the specified AWS endpoints whenever content changes occur for those content types in that environment.

**Webhook Types Created:** In V2, the tool creates 10 webhooks covering a range of content types and actions. These include webhooks for content models such as **Ventures**, **Categories**, **Sections**, **Personalised Sections**, **Layouts**, **Games V2**, **SiteGames V2**, **Suggested Games**, plus two delete handlers (**General Delete** and **Game V2 Delete**)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L111-L120). Together, these capture all relevant content changes in the ‚ÄúV2‚Äù (legacy or current) content models of the lobby. For V3 (the next-generation content API), there are 12 webhooks including **Ventures V3**, **Navigation**, **View**, **Game Sections**, **Marketing Sections**, **ML (Machine Learning) Sections** and **ML Defaults**, **Games V3**, **Site Games V3**, **Themes**, and corresponding delete handlers[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L125-L133)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L134-L136). Essentially, each major content entity in Contentful that needs to be indexed in OpenSearch has a webhook in the suite.

**Key Features of Create Command:**

- **üèóÔ∏è Bulk Environment Setup:** The create operation sets up the *entire* set of webhooks for an environment in one go. It does not support selecting individual webhook types ‚Äì it‚Äôs all-or-nothing for a given suite. This ensures a consistent, complete configuration with one command (no missing pieces)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L81-L89).
- **üìã Predefined Order:** Webhooks are created in a fixed, logical sequence. This ordering is designed to handle dependencies or logical groupings (for example, create all ‚Äúupdate‚Äù webhooks before ‚Äúdelete‚Äù webhooks). It also makes the console output easier to follow, as each webhook creation step is logged in order[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L86-L93).
- **üîß Consistent Payload Construction:** The tool uses the same underlying payload-building functions here as used in updates, meaning the JSON structure sent to OpenSearch is consistent across create and update operations[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L91-L95). All payloads are derived from the current code/config, so they reflect the latest expected schema for OpenSearch.
- **‚ö° Fail-Fast on Errors:** If any webhook fails to create (e.g., network issue or a bad request), the tool immediately aborts the process. No further webhooks are attempted[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L96-L99). This prevents a scenario where some webhooks are created and others not, which could complicate recovery. The downside is a failed run might require cleanup, but it makes failures very visible.
- **üéØ Environment-Specific Config:** The creation uses configuration driven entirely by `config.js` and environment variables, meaning it will automatically point webhooks to the correct endpoints for the chosen environment (dev/staging/prod) and region (EU/NA)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L101-L105). The credentials (like basic auth for OpenSearch) are encoded and included via custom headers on each webhook call so that the receiving endpoint can authenticate[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/hookPayloads/common/shared.js#L16-L25).

### Webhook Update Workflow (Selective Updates by ID)

The **update command** allows developers to update one or more existing webhooks in Contentful to match the latest configuration or payload definitions in the code. This is useful if the webhook definitions (URLs, filters, payload structure, headers, etc.) have changed in the tool and you need to apply those changes to webhooks that were previously created. Instead of deleting and recreating webhooks, `hook:update` will perform an in-place update via the Contentful API for specified webhook IDs.

Workflow for `yarn hook:update --ids <id1,id2,...>` (and similarly `hook:update:v3`):

1. **Parse Input IDs:** The CLI accepts a comma-separated list of Contentful webhook IDs through the `-ids` option. It splits and trims this list to get the individual IDs to process[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L12-L20). These IDs are the unique identifiers Contentful assigns to each webhook (obtained for example from Contentful UI or from prior create output).
2. **Initialize Config:** As with create, it loads environment settings from `NODE_ENV` and `JURISDICTION` and prepares the Axios client and credentials for OpenSearch[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L16-L24)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L62-L70). The assumption is that the webhooks you want to update belong to that environment/space, so the correct config must be loaded to rebuild them.
3. **Loop Through IDs:** The tool then iterates over each provided webhook ID one by one (sequential processing)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L20-L28). This one-by-one approach is intentional to handle errors gracefully per webhook rather than failing everything at once.
4. **Validate Existence and Ownership:** For each ID, it first fetches the existing webhook definition from Contentful (`GET /webhook_definitions/{id}`) using the Contentful API[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L78-L86). It checks if the webhook exists and also verifies that it contains the expected **ownership marker** (the custom header `X-unique-own-identifier: lobby-openSearch`). This ensures the webhook was originally created by this tool and is of the type we manage[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L106-L114). If the webhook is not found (Contentful returns 404) or the webhook doesn‚Äôt have the identifying header (meaning it might not be one of our ‚Äúowned‚Äù webhooks), the tool **logs an error and skips** that ID[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L26-L34)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L116-L124). It will not attempt to update webhooks that it doesn‚Äôt recognize as its own, to avoid tampering with any other integrations.
5. **Identify Webhook Type:** If the webhook passes ownership validation, the tool determines which type of webhook it is. This is done by examining the webhook‚Äôs name (which includes a suffix indicating its content model or purpose) and matching it against known patterns (like those in `webhookTextParts.js`)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L28-L36). The CLI can infer whether it‚Äôs a V2 or V3 webhook and exactly which model (e.g., a ‚ÄúGames V2‚Äù update webhook, a ‚ÄúThemes‚Äù webhook, etc.) by parsing the name[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L26-L34)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/constants/webhookTextParts.js#L65-L73). If for some reason the type can‚Äôt be identified (name doesn‚Äôt match expected patterns), it logs an error and skips that webhook as well[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L30-L38).
6. **Rebuild Payload:** Once the type is identified, the tool uses the current code‚Äôs payload builder functions to construct a fresh webhook payload and configuration for this webhook type[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L32-L40). This means it generates what a new webhook of that type *should* look like (URL, filters, headers, payload template) using the up-to-date environment settings and code logic. Importantly, it does *not* reuse the old webhook‚Äôs data except for its ID and type ‚Äì it treats it as if creating from scratch, to ensure the latest schema is applied[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L112-L120).
7. **PUT Update via Contentful API:** The CLI then calls the Contentful Management API to update the webhook: it sends a `PUT /webhook_definitions/<id>` request with the new payload. It includes the last known *version number* of the webhook in this request via the `X-Contentful-Version` header[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L38-L46)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/webhooksHttpReq.js#L13-L21). (Contentful requires a version for concurrency control ‚Äì the tool likely got the current version in the GET response.) This mechanism is **optimistic locking**: if the webhook was changed in Contentful between the GET and PUT, the version would mismatch and Contentful would reject the update, protecting against race conditions[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L122-L130).
8. **Success or Error Handling:** If the update succeeds (Contentful returns 200 OK), the tool logs a success message for that webhook ID[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L82-L90). If the update fails (e.g., due to a version conflict or other error), it logs an error for that ID[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L84-L92). Notably, an error for one webhook **does not stop the loop** ‚Äì the tool continues to the next ID in the list regardless[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L40-L48)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L116-L124). This is a **graceful error handling** approach: it ensures one problematic webhook (or an invalid ID) won‚Äôt prevent updates to others.
9. **Completion:** After all IDs have been processed, the CLI prints a summary or final message indicating the update process is complete[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L94-L98). Some webhooks may have been updated successfully while others might have been skipped or failed; the log output will reflect each case.

**Key Features of Update Command:**

- **üîç Sequential Per-ID Processing:** Unlike the create command, updates are intentionally not bulked together. Each webhook ID is handled one at a time. This simplifies troubleshooting and ensures that a failure on one ID doesn‚Äôt abort the others ‚Äì you can update 100 webhooks in a row and if 5 fail, 95 still get updated in that run[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L102-L110).
- **üõ°Ô∏è Multiple Validation Layers:** Before updating, the tool performs several checks: (1) Does the webhook exist in Contentful? (2) Was it created by contentful-hooks (checked via the unique header)? (3) Can we determine what kind of webhook it is (based on naming)? (4) Does the type/version match what the user invoked (e.g., you didn‚Äôt accidentally give a V3 ID to the `update` V2 command)? Only if all checks pass does the update proceed[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L106-L114)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/constants/webhookTextParts.js#L72-L80). These validations prevent mis-targeting or errors like trying to update a webhook that doesn‚Äôt belong to this system.
- **‚öôÔ∏è Environment-Driven Rebuild:** The update doesn‚Äôt copy any old configuration from the webhook except its identity. It rebuilds the definition using the code‚Äôs current logic and the environment‚Äôs current settings[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L112-L120). This means if you‚Äôve changed the OpenSearch index name, or added a new header, or modified which fields are sent in the payload, the update will apply all those changes. The existing webhook‚Äôs configuration in Contentful is essentially overwritten with the ‚Äúlatest truth‚Äù from the repository.
- **üéØ Graceful Error Handling:** The update workflow is robust to issues with individual webhooks. If a webhook ID is invalid, not found, or not owned by the tool, it logs a warning and moves on[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L116-L124). If the PUT request fails (e.g., due to a stale version or a network hiccup), it logs that error and continues. It does not halt the entire operation for a single failure. This way, you can batch-update multiple webhooks and only the ones with issues will be left unchanged, with clear logs indicating which ones those were.
- **üîÑ Optimistic Locking:** By using the `X-Contentful-Version` header on updates, contentful-hooks ensures it doesn‚Äôt overwrite changes if, say, someone manually edited the webhook or another process updated it between your GET and PUT. If such a concurrency issue occurs, Contentful will reject the update (which the tool logs as an error for you)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L122-L130). This adds a layer of safety to updates, ensuring consistency in how changes are applied.

### Webhook Deletion Workflow (Flexible Cleanup)

The **delete command** is used to remove webhooks that were created by this tool, either individually or in bulk. This is useful in scenarios such as cleaning up all webhooks in an environment (e.g., tearing down a staging environment‚Äôs webhooks, or resetting after testing) or removing a specific webhook that is no longer needed. The deletion functionality supports three modes, all accessible via the single `delete` command with different options:

- **Single webhook deletion** ‚Äì `-one <webhookId>`: Delete a specific webhook by its Contentful ID.
- **Environment-based deletion** ‚Äì `-env [DEV|STG|PROD]`: Delete all webhooks for a given environment (e.g., all webhooks whose name contains `[DEV]` if you specify `-env [DEV]`).
- **Complete cleanup** ‚Äì `-all`: Delete **all** webhooks that were created by this tool, regardless of environment.

The user must provide **exactly one** of these options when running the delete command (the CLI will validate that you didn‚Äôt, for example, specify both `--one` and `--all` at the same time)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L80-L88)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L16-L24).

The deletion workflow proceeds as follows:

1. **Validate Mode Option:** When invoked, the CLI first checks that one (and only one) of `-one`, `-env`, or `-all` was provided. If none or an invalid combination is given, it exits with an error telling the user how to correctly specify the mode[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L80-L88). This prevents confusion or accidental broad deletions.
2. **Fetch All Owned Webhooks:** The tool then retrieves the full list of webhook definitions from Contentful for the target space (it calls the Contentful API with something like `GET /webhook_definitions?limit=200`)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L88-L96)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/collectHooks.js#L3-L6). It parses the response to filter down only those webhooks that have the unique ownership header (`X-unique-own-identifier: lobby-openSearch`)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L92-L100)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/collectHooks.js#L14-L22). This yields a list of **owned webhooks** that the tool is responsible for. Webhooks not created by contentful-hooks are ignored and protected.
3. **Identify Target Webhooks:** Depending on the mode:
    - **Single ID mode (`-one`)**: The tool will look for that one ID in the owned webhook list. If found, that becomes the sole target. If not found (maybe the ID doesn‚Äôt exist or isn‚Äôt owned), it will end the process with a message that no such webhook was found[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L30-L38)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L100-L108).
    - **Environment mode (`-env [ENV]`)**: The tool filters the owned webhooks to those whose names contain the specified environment tag (e.g., ‚Äú[DEV]‚Äù). It essentially picks out all webhooks belonging to that environment slice[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L18-L26)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/webhooksApi/collectHooks.js#L30-L37). If none are found for that environment (for example, maybe there were no staging webhooks set up), it logs that no webhooks were found and exits[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L30-L38).
    - **All mode (`-all`)**: No further filtering is needed; *every* owned webhook is targeted for deletion[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L20-L28).
4. **Perform Deletions Sequentially:** Much like the update process, deletions are done one webhook at a time in a loop (to be gentle on the API and to handle errors individually)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L33-L41)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L134-L143). For each target webhook in the list, the CLI sends a `DELETE /webhook_definitions/{id}` request via the Contentful API.
5. **Logging and Error Handling:** For each deletion attempt, if Contentful responds with success (HTTP 204 or 200), the tool logs a success message indicating that webhook was deleted[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L36-L44)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L140-L143). If Contentful returns an error (e.g., network issue or the webhook was already gone), the tool logs an error for that particular webhook ID and continues to the next[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L39-L47). Errors do not stop the loop; they are simply noted. This means even if, say, one webhook out of ten fails to delete (perhaps due to an intermittent issue), the others will still be processed.
6. **Completion:** After iterating through all targets, the tool logs that the deletion process is complete[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L45-L53)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L119-L123). If any webhooks were not found or couldn‚Äôt be deleted, those would have been mentioned in the logs earlier. In environment or all mode, it will have effectively cleaned up the specified scope of webhooks. In single mode, after deletion there‚Äôs nothing more to do.

**Key Features of Delete Command:**

- **üîí Ownership Validation:** The deletion command is *safe by design* ‚Äì it will only delete webhooks that carry the specific identifier header that marks them as created by this tool[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L125-L133). This prevents accidental deletion of any other webhooks that might exist in the Contentful space (perhaps set up by other systems or manually). It‚Äôs a protective filter that runs automatically when collecting webhooks to delete.
- **üéØ Multiple Deletion Modes:** The CLI supports flexible use cases by offering three modes of deletion[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L65-L73). This means you can surgically remove one webhook if needed (perhaps testing or replacing a single integration), or wipe an entire environment‚Äôs webhooks (useful when repurposing an environment or doing a cleanup before a fresh setup), or even wipe everything the tool created (`-all`, which might be used if decommissioning the integration entirely)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L130-L138).
- **üîÑ Sequential Processing:** Webhooks are deleted one by one. This ensures that each API call is made and checked, and that if a deletion fails, it doesn‚Äôt prevent trying to delete the rest[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L134-L143). Sequential processing also provides a clear log/output sequence showing each webhook ID as it‚Äôs being deleted, which is useful for audit purposes.
- **üìã Comprehensive Logging:** The tool logs what it‚Äôs doing at each step ‚Äì for example, it will log how many webhooks were found that match your criteria and which IDs it is about to delete[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L100-L108)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L140-L143). As it deletes each webhook, it logs success or failure. And if no webhooks are found for your request, it explicitly tells you so (so you‚Äôre not left wondering if something happened)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L30-L38). This transparency makes it easier to use safely, as you can verify exactly what was done after running the command.
- **üõ°Ô∏è Safety Features:** In addition to ownership checks, the delete command includes other safety measures. It requires an explicit confirmation of scope via the command options (you have to deliberately choose `-all` to delete everything, it won‚Äôt do so by default). It also gracefully handles the case where nothing is found to delete ‚Äì simply reporting and exiting without error[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L30-L38). The combination of these features means the delete operation is controlled and with low risk of inadvertently deleting the wrong things.

## Configuration and Environment Setup

Before using contentful-hooks, some one-time setup is required to configure your environments:

- **Environment Variables:** All sensitive values and environment-specific parameters are provided via environment variables. The repository includes an **`env_example`** file that lists all required variables for both EU and NA jurisdictions across dev, staging, and prod environments[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L2-L10)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L26-L34). Copy this file to `.env` in the project root and fill in the values:
    - **Contentful Credentials:** For each environment (dev/stg/prod) and region (EU/NA), you need a Contentful Management API **Bearer Token** and the **Space ID**. These are labeled like `DEV_EU_CONTENTFUL_BEARER_TOKEN` and `DEV_EU_CONTENTFUL_SPACE` (for EU dev), `NA_STG_CONTENTFUL_BEARER_TOKEN` etc. The Space ID is included as part of a full API URL in the example (e.g., `https://api.contentful.com/spaces/<space-id>/`), which the tool likely parses or uses directly[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L6-L14)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L30-L38). Ensure the tokens have rights to manage webhooks in that space.
    - **OpenSearch Credentials and URLs:** You must provide the **OpenSearch (or API Gateway) endpoint URLs** for each environment/region, and the corresponding **username/password** that the webhook should use to authenticate. In the env example, these are `DEV_OS_HOST`, `DEV_OS_USER`, `DEV_OS_PASS`, and similarly for STG and PROD (and NA variants)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L6-L14)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L30-L38). The OS_HOST is the base URL of the API Gateway that fronts OpenSearch (for example, the env example shows a Dev URL for EU and NA which are different AWS API endpoints).
    - **Contentful Environment**: Contentful allows multiple environments within a space (like branches). Variables like `DEV_CONTENTFUL_ENV` define which Contentful environment (e.g., `dev` or `master`) to target for each deployment stage[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L8-L16)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L30-L38). The example uses `dev` for dev/QA and `master` for stg/prod by default. Make sure these match the Contentful environment where your content for that stage resides.
    - **NODE_ENV and JURISDICTION:** These two variables control which config block is used. `NODE_ENV` should be set to one of `dev`, `stg`, or `prod` to pick the environment, and `JURISDICTION` to `eu` or `na` to pick the region (you‚Äôll typically run the tool twice if you need to set up both EU and NA, each with different JURISDICTION). Only one jurisdiction‚Äôs config is used per invocation. In the `.env` file, you might leave JURISDICTION commented out and instead provide it at runtime, or set it there when working primarily with one region[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L2-L10)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L26-L34).
- **Config Validation:** When you run a command, the tool will load `src/config.js` which maps the above env vars into a config object. It then **validates** that none of the required fields are missing for the chosen environment. If, for example, you forgot to set `STG_OS_HOST` and you run with `NODE_ENV=stg`, the tool will throw an error like ‚ÄúMissing configuration for: OS_HOST‚Äù and exit[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/src/utils.js#L27-L34). This validation happens before any API calls, to prevent partially executing actions with incomplete config[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L70-L78). Therefore, ensure your `.env` is fully populated for the environment you intend to manage.
- **Multi-Region Note:** EU and NA have separate Contentful spaces and likely separate OpenSearch clusters. The tool‚Äôs design with `eu` and `na` config sections means you need to run it per jurisdiction. For example, to set up dev EU, you‚Äôd set JURISDICTION=eu and NODE_ENV=dev (or use a prefix on the command line) and run `yarn hook:create`; then to set up dev NA, change JURISDICTION=na and run the command again. Each will read the corresponding config (e.g., `DEV_EU_CONTENTFUL_SPACE` vs `NA_DEV_CONTENTFUL_SPACE`) and act on the respective Contentful space.
- **Installation:** To install the tool locally, clone the repository and install dependencies. For example:
    
    ```bash
    git clone <repo-url> contentful-hooks   # clone the repository
    cd contentful-hooks
    yarn install                            # install Node dependencies
    cp env_example .env                     # create your environment config
    
    ```
    
    Ensure you are using Node.js 18 or newer to meet the runtime requirement[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L13-L19). After installation and config, you can run the CLI via the provided Yarn scripts or directly with Node.
    

## Usage Guide (Commands and Examples)

Once configured, you can use **Yarn scripts** defined in `package.json` or direct `node` commands to invoke contentful-hooks. All commands follow the pattern: `contentful-hooks <command> [options]`. Here‚Äôs a summary of the available commands and how to use them:

- **Create all V2 webhooks:**
    
    Run `yarn hook:create` (which executes `node src/index.js create` under the hood) to provision the full set of ‚ÄúV2‚Äù webhooks for the current environment[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L85-L91). This will create 10 webhooks covering ventures, games, sections, deletes, etc., as described earlier. For example:
    
    ```bash
    NODE_ENV=dev JURISDICTION=eu yarn hook:create
    
    ```
    
    (This would create all dev EU webhooks, assuming env vars are set in .env or prefixed as shown.)
    
- **Create all V3 webhooks:**
    
    Run `yarn hook:create:v3` to provision the V3-specific webhooks (12 webhooks for the newer content models/APIs)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L93-L97). Usage is analogous to the above, just adding the `:v3`. e.g., `NODE_ENV=stg JURISDICTION=na yarn hook:create:v3` to create all staging NA V3 webhooks.
    
- **Update webhooks by ID (V2):**
    
    Use `yarn hook:update --ids <id1,id2,...>` to update one or multiple existing webhooks (that were previously created) to the latest config[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L99-L107). You need to specify the Contentful webhook IDs (one or many separated by commas). For example:
    
    ```bash
    yarn hook:update --ids 4nFpMw2...Yg,5iLgHw3...Pd
    
    ```
    
    This will fetch and attempt to update those two webhooks (assuming they belong to the currently set NODE_ENV and JURISDICTION). The tool will automatically detect if each ID corresponds to a V2 type webhook.
    
- **Update webhooks by ID (V3):**
    
    Similarly, `yarn hook:update:v3 --ids <id1,id2>` is available for explicitly updating V3 webhooks[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L105-L110). In practice, `hook:update` will handle both types by checking the webhook name, but the `:v3` variant might ensure that you intend those IDs to be V3 hooks. Use whichever is appropriate; both commands behave similarly as described in the Update Workflow section.
    
- **Delete a single webhook:**
    
    To delete one webhook by ID, you can run `yarn delete:one` after configuring the ID in the package script, *or* directly use the underlying command: `node src/index.js delete --one <webhookId>`[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L113-L120). For example:
    
    ```bash
    yarn delete:one
    
    ```
    
    (Note: The `delete:one` script in package.json is configured with a placeholder ID[GitHub](https://github.com/devminchev/tech-docs/blob/69c62ef62c3e714eea9f7246b08c7568435d8b05/contentful-cms-models/contentful-content-opensearch-webhooks/package.json#L14-L19). You might edit it or bypass it by using the direct `node` command as shown with the actual ID.)
    
- **Delete all webhooks for an environment:**
    
    Use `yarn delete:env:dev` (or `delete:env:stg` / `delete:env:prod` accordingly) to remove **every webhook for that environment**[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L115-L120). This uses the `--env [DEV]` (or `[STG]`, `[PROD]`) option internally. For instance, `yarn delete:env:prod` will delete all webhooks whose names contain `[PROD]` (in the current jurisdiction‚Äôs Contentful space)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L116-L120). Alternatively, `node src/index.js delete --env "[DEV]"` can be run for a custom call.
    
- **Delete all owned webhooks:**
    
    Run `yarn delete:all` to delete **every webhook that contentful-hooks has created** in the current Contentful space[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L119-L125). This uses the `--all` flag. It will enumerate all webhooks with the ownership tag and sequentially delete them, as described above. Use this with caution ‚Äì it‚Äôs great for a cleanup/reset, but it will remove V2 and V3 webhooks alike.
    

**Note:** Always ensure that `NODE_ENV` and `JURISDICTION` are set to the correct targets when running these commands (either via your shell environment or by prefixing the command). The tool will act on the environment specified. For example, if you accidentally leave `NODE_ENV=dev` and run a delete, you might delete dev webhooks instead of staging. Double-check before running destructive commands.

## Conclusion

By automating webhook management, **contentful-hooks** streamlines the integration between Contentful and OpenSearch for our iGaming lobby content. It provides a repeatable, CLI-driven process to manage complex configurations across multiple environments and regions. New developers should now have an understanding of what this tool is for (keeping Contentful and OpenSearch data in sync without manual effort), how it‚Äôs built (Node.js CLI with Commander, Axios, and Contentful API), and how it operates under the hood (bulk creating webhooks with consistent payloads, safely updating them, and cleaning them up when needed). Non-technical stakeholders can appreciate that this reduces error-prone manual setup and ensures content updates flow reliably to user-facing search indices, while technical users can dive into the configuration and code to adjust the behavior as requirements evolve.

With this guide and the in-repo documentation[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L126-L134), onboarding to the contentful-hooks project should be much easier. Feel free to explore the `docs/` folder for the detailed flowcharts and additional context on each command, and use this tool to maintain the content pipeline efficiently.

**Sources:**

1. contentful-hooks Repository ‚Äì README (Project Overview, Tech Stack, Usage)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L3-L11)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L10-L18)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L70-L78)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L85-L93)
2. contentful-hooks Repository ‚Äì Project Architecture (Code Structure)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L35-L43)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/Readme.md#L42-L48)
3. contentful-hooks Repository ‚Äì Webhook Create Workflow (Documentation)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L23-L31)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L96-L99)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-create-workflow.md#L111-L120)
4. contentful-hooks Repository ‚Äì Webhook Update Workflow (Documentation)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L26-L34)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L116-L124)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-update-workflow.md#L122-L130)
5. contentful-hooks Repository ‚Äì Webhook Delete Workflow (Documentation)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L36-L44)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L125-L133)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/docs/webhook-delete-workflow.md#L134-L143)
6. contentful-hooks Repository ‚Äì env_example (Environment Config Template)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L6-L14)[GitHub](https://gitlab.ballys.tech/excite/native/tools/contentful-hooks/blob/cd700ee370b9b778a98e778a152d6c3129bdc973/env_example#L30-L38)